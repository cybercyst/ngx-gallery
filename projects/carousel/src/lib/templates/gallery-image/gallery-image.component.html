<ng-container [lazyImage]="src"
              (progress)="onProgress($event)"
              (loaded)="onLoaded($event)"
              (error)="onError($event)"
              [ngSwitch]="state | async">

  <div *ngSwitchCase="'success'"
       @fadeIn
       class="g-image-item">
    <img width="100%" height="100%" [src]="src" alt="gallery-image" loading="lazy">
  </div>

  <div *ngSwitchCase="'failed'"
       class="g-image-error-message">
    <ng-container *ngTemplateOutlet="errorTemplate || defaultError"></ng-container>
    <ng-template #defaultError>
      <ng-container *ngIf="isThumbnail; else isLarge">
        <h4>⚠</h4>
      </ng-container>
      <ng-template #isLarge>
        <h2>⚠</h2>
        <div>Unable to load the image!</div>
      </ng-template>
    </ng-template>
  </div>

  <ng-container *ngSwitchCase="'loading'">
    <ng-template [ngTemplateOutlet]="loadingTemplate || isThumbnail ? defaultThumbLoader : defaultLoader"></ng-template>
  </ng-container>

  <ng-template #defaultLoader>
    <div class="g-loading">
      <svg stroke="#fff" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
        <g fill="none" fill-rule="evenodd" stroke-width="2">
          <circle cx="22" cy="22" r="1">
            <animate attributeName="r" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1"
                     repeatCount="indefinite" values="1; 20"/>
            <animate attributeName="stroke-opacity" begin="0s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1"
                     keyTimes="0; 1"
                     repeatCount="indefinite" values="1; 0"/>
          </circle>
          <circle cx="22" cy="22" r="1">
            <animate attributeName="r" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.165, 0.84, 0.44, 1" keyTimes="0; 1"
                     repeatCount="indefinite" values="1; 20"/>
            <animate attributeName="stroke-opacity" begin="-0.9s" calcMode="spline" dur="1.8s" keySplines="0.3, 0.61, 0.355, 1"
                     keyTimes="0; 1" repeatCount="indefinite" values="1; 0"/>
          </circle>
        </g>
      </svg>
    </div>
  </ng-template>
  <ng-template #defaultThumbLoader>
    <div *ngIf="isThumbnail" class="g-thumb-loading"></div>
  </ng-template>
</ng-container>
